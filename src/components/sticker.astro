---
import { Image } from "astro:assets"
import type { ImageMetadata } from "astro"

interface Props {
  src: ImageMetadata;
  alt: string;
  width: number;
  shadow?: boolean;
  class?: string;
}
const { src, alt, width, shadow, class: className } = Astro.props;
---

<div class="touch-none" data-sticker>
	<Image src={src} alt={alt} width={width} class:list={[
    className,
    shadow && "drop-shadow-sticker",
    "transition hover:scale-110 active:scale-100 active:opacity-75"
  ]} draggable={false} />
</div>

<script>
  const stickers = document.querySelectorAll<HTMLDivElement>('[data-sticker]');

  for (const sticker of stickers) {
    sticker.addEventListener("mousedown", (event) => {
      event.preventDefault();
      sticker.dataset.dragging = "true";
    });
    document.addEventListener("mouseup", () => {
      delete sticker.dataset.dragging;
    });
    document.addEventListener("mousemove", (event) => {
      if (sticker.dataset.dragging === "true") {
        if(sticker.dataset.x === undefined || sticker.dataset.y === undefined) {
          sticker.dataset.x = "0";
          sticker.dataset.y = "0";
        } else {
          const dx = event.movementX;
          const dy = event.movementY;
          const x = parseFloat(sticker.dataset.x) + dx;
          const y = parseFloat(sticker.dataset.y) + dy;
          sticker.style.transform = `translate(${x}px, ${y}px)`;
          sticker.dataset.x = x.toString();
          sticker.dataset.y = y.toString();
        }
      }
    });
  }
</script>